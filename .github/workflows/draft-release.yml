name: üì¶ Release
on:
  milestone:
    types: [closed]
jobs:
  release:
    name: üìù Draft Release
    runs-on: ubuntu-latest
    steps:
      - name: üì∞ Checkout
        uses: actions/checkout@v2
      - name: ü•å Set milestone name
        run: echo MILESTONE_NAME=$(jq --raw-output .milestone.title $GITHUB_EVENT_PATH) >> $GITHUB_ENV
      - name: ‚úèÔ∏è Set milestone description
        run: echo MILESTONE_DESCRIPTION=$(jq --raw-output .milestone.description $GITHUB_EVENT_PATH) >> $GITHUB_ENV
      - name: üè∑Ô∏è Set tag name
        run: echo TAG_NAME=${MILESTONE_NAME%% *} >> $GITHUB_ENV
      - name: üìù Generate Changelog
        run: echo "# ${{ env.TAG_NAME }}" > ${{ github.workspace }}-CHANGELOG.txt
      - name: üêõ debug
        run: echo ${{ env }}
      - name: üì¶ Release
        uses: softprops/action-gh-release@v1
        with:
          name: ${{ env.MILESTONE_NAME }}
          tag_name: ${{ env.TAG_NAME }}
          body_path: ${{ github.workspace }}-CHANGELOG.txt
          body: ${{ env.MILESTONE_DESCRIPTION }}
          generate_release_notes: true
          draft: true
